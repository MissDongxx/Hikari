# 动作对比 AI 分析平台 - 工程任务清单

> **Planner Agent 输出**  
> 基于文档: [architecture.md](file:///Users/xumingyue/Downloads/MyProjects/movechecker/docs/architecture.md)  
> 日期: 2026-01-14  
> 版本: MVP 1.0

---

## 任务分解策略

根据架构文档 10.6 节「实施路径」，采用 **纯新增、零重构** 策略，将任务分为 4 个阶段：

1. 数据库扩展（1天）
2. Python AI 后端开发（3-5天）
3. 前端集成（2-3天）
4. 部署与测试（1-2天）

**核心原则**：现有代码完全不动，仅叠加新功能

---

## 阶段 1：数据库扩展（共 3 个任务）

### T1.1 - 创建 AI 数据表结构

**优先级**: P0  
**估算工时**: 2 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
在 Supabase PostgreSQL 中执行 SQL 脚本，创建 AI 动作分析所需的 4 张新表，不删除任何现有表。

**输入**:
- 现有 Supabase 数据库连接凭证
- 架构文档 10.4 节定义的表结构 SQL

**输出**:
- 新增数据表：
  - `exercise_types` - 动作类型表
  - `video_uploads` - 视频上传记录表
  - `analysis_tasks` - 分析任务表
  - `analysis_results` - 分析结果表
- SQL 迁移脚本文件（`supabase/migrations/xxx_add_ai_tables.sql`）

**验证方式**:
- [ ] 在 Supabase Dashboard 确认 4 张表创建成功
- [ ] 验证外键约束正确（关联到 `auth.users` 表）
- [ ] 确认与现有 Stripe 表无命名冲突

**依赖**:
- 无（独立任务）

**风险点**:
- ⚠️ 外键约束可能因 `auth.users` schema 权限问题失败
- **应对**: 使用 Supabase 提供的标准 schema，或改用 UUID 索引

---

### T1.2 - 插入初始数据

**优先级**: P0  
**估算工时**: 0.5 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
在 `exercise_types` 表中插入 MVP 阶段唯一支持的动作类型：深蹲（Squat）。

**输入**:
- T1.1 完成的数据表
- 动作类型多语言数据（en/zh/ja）

**输出**:
- `exercise_types` 表新增 1 条记录：
  ```sql
  {
    id: 1,
    name: 'squat',
    display_name: {
      "en": "Squat",
      "zh": "深蹲",
      "ja": "スクワット"
    },
    enabled: true
  }
  ```

**验证方式**:
- [ ] 查询 `SELECT * FROM exercise_types` 返回 1 条记录

**依赖**:
- T1.1（必须先创建表）

---

### T1.3 - 配置 Supabase Storage Bucket

**优先级**: P0  
**估算工时**: 1 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
在 Supabase Storage 中创建专用 Bucket 用于存储用户上传的视频和参考视频。

**输入**:
- Supabase 项目访问权限
- 存储策略需求（私有访问）

**输出**:
- 新建 Bucket: `analysis-videos`
- 配置访问策略（Row Level Security）：
  - 用户仅能上传/查看自己的视频
  - 参考视频公开可读

**验证方式**:
- [ ] 手动上传测试文件成功
- [ ] 验证 RLS 策略生效（无法访问他人文件）

**依赖**:
- 无（独立任务）

---

## 阶段 2：Python AI 后端开发（共 8 个任务）

### T2.1 - 初始化 Python 项目

**优先级**: P0  
**估算工时**: 1 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
创建独立的 Python 后端项目，初始化虚拟环境和目录结构。

**输入**:
- Python 3.10+ 运行时环境

**输出**:
- 项目目录结构：
  ```
  movechecker-ai-backend/
  ├── main.py
  ├── requirements.txt
  ├── .env.example
  ├── routers/
  ├── services/
  ├── models/
  └── tests/
  ```
- 虚拟环境已激活
- `requirements.txt` 基础依赖列表

**验证方式**:
- [ ] `python main.py` 启动成功（返回 Hello World）

**依赖**:
- 无（独立任务）

---

### T2.2 - 安装核心依赖

**优先级**: P0  
**估算工时**: 1 小时  
**风险等级**: 🟡 中风险

**任务描述**:  
安装 FastAPI、MediaPipe、OpenCV、Supabase 客户端等核心库。

**输入**:
- T2.1 创建的项目环境

**输出**:
- `requirements.txt` 完整依赖清单：
  ```
  fastapi==0.115.0
  uvicorn[standard]==0.32.0
  mediapipe==0.10.14
  opencv-python==4.10.0
  supabase==2.9.1
  pydantic==2.10.0
  python-dotenv==1.0.1
  ```
- 所有依赖安装成功

**验证方式**:
- [ ] `pip list` 确认版本正确
- [ ] `import mediapipe, cv2` 无报错

**依赖**:
- T2.1

**风险点**:
- ⚠️ MediaPipe 在某些系统（如 M1 Mac）可能编译失败
- **应对**: 使用预编译二进制包或 Docker 环境

---

### T2.3 - 实现 MediaPipe 姿态识别服务

**优先级**: P0  
**估算工时**: 4 小时  
**风险等级**: 🟡 中风险

**任务描述**:  
封装 MediaPipe Pose 模型，实现视频关键点提取功能。

**输入**:
- 视频文件路径（MP4/MOV 格式）
- MediaPipe 模型配置参数

**输出**:
- `services/mediapipe_service.py` 模块
- 关键函数：
  ```python
  def extract_pose_landmarks(video_path: str) -> list[dict]:
      """
      返回每一帧的 33 个关键点坐标
      格式: [
        {
          "frame_index": 0,
          "landmarks": [
            {"x": 0.5, "y": 0.6, "z": -0.1, "visibility": 0.99},
            ...
          ]
        },
        ...
      ]
      """
  ```

**验证方式**:
- [ ] 单元测试：输入标准深蹲视频，返回关键点数据
- [ ] 可视化测试：绘制骨架到图像，确认关键点位置准确

**依赖**:
- T2.2

**风险点**:
- ⚠️ MediaPipe 对低质量视频识别失败（多人、遮挡、光线暗）
- **应对**: 前端上传前校验视频质量，后端返回置信度过低错误

---

### T2.4 - 实现深蹲动作阶段切分算法

**优先级**: P1  
**估算工时**: 6 小时  
**风险等级**: 🔴 高风险

**任务描述**:  
基于关键点数据，识别深蹲动作的「站立 → 下蹲 → 站立」循环，切分出每个完整动作。

**输入**:
- T2.3 返回的关键点序列
- 深蹲动作定义规则（髋部纵坐标变化）

**输出**:
- `services/squat_segmentation.py` 模块
- 关键函数：
  ```python
  def segment_squat_cycles(landmarks: list[dict]) -> list[dict]:
      """
      返回每个深蹲周期的起止帧索引
      格式: [
        {"start_frame": 0, "bottom_frame": 15, "end_frame": 30},
        {"start_frame": 31, "bottom_frame": 45, "end_frame": 60},
      ]
      """
  ```

**验证方式**:
- [ ] 测试视频包含 3 个深蹲，算法正确识别 3 个周期
- [ ] 边界情况测试：只有半个动作、动作过快/过慢

**依赖**:
- T2.3

**风险点**:
- 🔴 **最高风险任务**：算法准确性直接影响产品核心价值
- ⚠️ 用户动作不标准时，可能无法识别
- **应对**: 
  - 初期允许手动标注起止帧（降级方案）
  - 收集 Bad Case 数据集迭代算法

---

### T2.5 - 实现深蹲对比维度计算

**优先级**: P0  
**估算工时**: 8 小时  
**风险等级**: 🔴 高风险

**任务描述**:  
实现架构文档定义的 4 个对比维度算法：下蹲深度、膝盖轨迹、上身前倾、左右平衡。

**输入**:
- 参考动作关键点数据
- 用户动作关键点数据
- T2.4 切分的动作周期

**输出**:
- `services/squat_analyzer.py` 模块
- 关键函数：
  ```python
  def analyze_squat_comparison(
      reference_landmarks: list[dict],
      user_landmarks: list[dict]
  ) -> dict:
      """
      返回对比结果：
      {
        "depth": {
          "status": "fail",  // "pass" | "warn" | "fail"
          "reference_value": 90,  // 髋部角度（度）
          "user_value": 120,
          "message": "下蹲深度不足，髋部未低于膝盖",
          "suggestion": "尝试增加下蹲深度，想象坐在椅子上"
        },
        "knee_tracking": {...},
        "torso_lean": {...},
        "balance": {...}
      }
      """
  ```

**验证方式**:
- [ ] 单元测试：标准动作 vs 标准动作 → 全部 "pass"
- [ ] 单元测试：标准动作 vs 已知错误动作 → 正确识别问题点
- [ ] 人工审核：5 个真实用户视频对比结果是否符合预期

**依赖**:
- T2.3, T2.4

**风险点**:
- 🔴 **最高风险任务**：算法准确性直接影响用户信任度
- ⚠️ 阈值设置过严或过松，导致误判
- **应对**: 
  - 初期提供 3 档敏感度（宽松/标准/严格）
  - 用户可标记"反馈不准确"收集数据

---

### T2.6 - 实现 FastAPI 路由

**优先级**: P0  
**估算工时**: 4 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
创建 RESTful API 端点，供前端调用分析功能。

**输入**:
- T2.3, T2.4, T2.5 实现的服务层函数
- Supabase 数据库连接

**输出**:
- API 端点：
  1. `POST /api/analyze` - 提交分析任务
     - 输入：`{user_id, reference_video_id, user_video_id}`
     - 输出：`{task_id}`
  2. `GET /api/tasks/{task_id}` - 查询任务状态
     - 输出：`{status: "pending" | "processing" | "completed" | "failed"}`
  3. `GET /api/results/{task_id}` - 获取分析结果
     - 输出：完整对比数据 + 骨架关键点

**验证方式**:
- [ ] Postman/curl 测试所有端点正常响应
- [ ] 异常情况处理（视频不存在、任务 ID 无效等）

**依赖**:
- T2.3, T2.4, T2.5

---

### T2.7 - 实现异步任务队列

**优先级**: P1  
**估算工时**: 4 小时  
**风险等级**: 🟡 中风险

**任务描述**:  
使用后台任务处理视频分析，避免阻塞 API 请求。

**输入**:
- FastAPI BackgroundTasks 或 Celery
- Supabase 数据库（存储任务状态）

**输出**:
- 异步任务执行流程：
  1. `POST /api/analyze` 立即返回 `task_id`
  2. 后台任务：
     - 更新任务状态为 "processing"
     - 下载视频 → 姿态识别 → 对比分析
     - 保存结果到数据库
     - 更新状态为 "completed"

**验证方式**:
- [ ] 模拟 30 秒分析时间，API 不阻塞
- [ ] 前端轮询 `/api/tasks/{id}` 能正确获取进度

**依赖**:
- T2.6

**风险点**:
- ⚠️ MVP 阶段简化方案（直接用 BackgroundTasks）可能不支持重启后恢复任务
- **应对**: 数据库记录任务状态，启动时检查 "processing" 状态任务并重试

---

### T2.8 - Supabase 数据库集成

**优先级**: P0  
**估算工时**: 3 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
在 Python 后端集成 Supabase 客户端，实现数据 CRUD 操作。

**输入**:
- Supabase 项目 URL 和 API Key
- T1.1 创建的数据表

**输出**:
- `services/supabase_service.py` 模块
- 关键函数：
  ```python
  async def create_analysis_task(...) -> str:
      """创建分析任务，返回 task_id"""
  
  async def update_task_status(task_id: str, status: str):
      """更新任务状态"""
  
  async def save_analysis_result(task_id: str, result: dict):
      """保存分析结果到 analysis_results 表"""
  ```

**验证方式**:
- [ ] 单元测试：创建任务 → 查询任务 → 更新状态 → 保存结果
- [ ] 在 Supabase Dashboard 确认数据正确写入

**依赖**:
- T1.1, T2.1

---

## 阶段 3：前端集成（共 7 个任务） [x]已完成

### T3.1 - 创建前端路由结构 [x]已完成

**优先级**: P0  
**估算工时**: 1 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
在现有 Next.js 项目中新增 `/analysis` 路由，不修改现有任何路由。

**输入**:
- 架构文档 3.2.2 节定义的页面结构

**输出**:
- 新建目录和文件：
  ```
  app/[locale]/analysis/
  ├── page.tsx              # 动作选择页（MVP 直接跳转到上传）
  ├── upload/
  │   └── page.tsx          # 视频上传页
  ├── processing/
  │   └── [id]/page.tsx     # 分析中页面
  └── results/
      └── [id]/page.tsx     # 结果展示页
  ```

**验证方式**:
- [ ] `npm run dev` 启动成功
- [ ] 访问 `/analysis` 页面无 404 错误

**依赖**:
- 无（独立任务）

---

### T3.2 - 实现视频上传组件 [x]已完成

**优先级**: P0  
**估算工时**: 6 小时  
**风险等级**: 🟡 中风险

**任务描述**:  
开发视频上传 UI 组件，支持本地视频上传到 Supabase Storage。

**输入**:
- Shadcn/ui 组件库（复用现有）
- Supabase Storage 客户端
- T1.3 创建的 Bucket

**输出**:
- `components/analysis/VideoUploader.tsx`
- 功能：
  - 拖拽上传或点击选择
  - 文件格式校验（MP4/MOV）
  - 文件大小限制（≤ 50MB）
  - 视频时长校验（≤ 15 秒）
  - 上传进度条
  - 预览播放

**验证方式**:
- [ ] 上传 MP4 视频成功，返回文件 URL
- [ ] 上传 AVI 视频被拒绝（格式不支持）
- [ ] 上传 20 秒视频被拒绝（超过时长限制）

**依赖**:
- T1.3, T3.1

**风险点**:
- ⚠️ 大文件上传超时或失败
- **应对**: 使用 Supabase 分片上传，前端显示重试选项

---

### T3.3 - 实现参考视频选择器 [x]已完成

**优先级**: P1  
**估算工时**: 3 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
提供系统默认参考视频供用户选择，或支持用户自定义上传。

**输入**:
- 预制的标准深蹲参考视频（需提前录制）
- T3.2 视频上传组件

**输出**:
- `components/analysis/ReferenceVideoSelector.tsx`
- 功能：
  - 默认选项：「使用标准参考视频（推荐）」
  - 自定义选项：「上传自己的参考视频」
  - 视频预览播放

**验证方式**:
- [ ] 选择默认视频，正确传递 `reference_video_id`
- [ ] 上传自定义视频，正确传递新视频 ID

**依赖**:
- T3.2

---

### T3.4 - 实现上传页面完整流程 [x]已完成

**优先级**: P0  
**估算工时**: 4 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
整合 T3.2 和 T3.3，完成视频上传页面。

**输入**:
- T3.2 视频上传组件
- T3.3 参考视频选择器
- Supabase Auth（获取当前用户）

**输出**:
- `app/[locale]/analysis/upload/page.tsx`
- 页面布局：
  - 左侧：参考视频选择区
  - 右侧：用户视频上传区
  - 底部：「开始分析」按钮
- 功能：
  - 表单验证（两个视频都已上传）
  - 点击「开始分析」调用 Python 后端 `POST /api/analyze`
  - 跳转到分析中页面

**验证方式**:
- [ ] 完整流程测试：选择参考视频 → 上传用户视频 → 点击分析 → 跳转成功

**依赖**:
- T3.2, T3.3, T2.6

---

### T3.5 - 实现分析中页面 [x]已完成

**优先级**: P0  
**估算工时**: 3 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
开发加载等待页面，轮询后端任务状态。

**输入**:
- 任务 ID（从 URL 参数获取）
- Python 后端 `GET /api/tasks/{id}` 接口

**输出**:
- `app/[locale]/analysis/processing/[id]/page.tsx`
- 功能：
  - 动画加载指示器
  - 预估时间提示：「分析中，预计 10-30 秒」
  - 每 2 秒轮询任务状态
  - 状态为 "completed" 时自动跳转到结果页
  - 状态为 "failed" 时显示错误信息

**验证方式**:
- [ ] 模拟任务从 "pending" → "completed"，页面自动跳转
- [ ] 模拟任务失败，显示错误提示

**依赖**:
- T3.4, T2.6

---

### T3.6 - 实现骨架可视化组件 [x]已完成

**优先级**: P0  
**估算工时**: 8 小时  
**风险等级**: 🔴 高风险

**任务描述**:  
使用 Canvas API 绘制人体骨架，支持播放/暂停/逐帧查看。

**输入**:
- MediaPipe 关键点数据（33 个点坐标）
- 视频元数据（宽高、帧率）

**输出**:
- `components/analysis/SkeletonCanvas.tsx`
- 功能：
  - 绘制骨架线条（肩-肘-腕、髋-膝-踝等）
  - 问题关节点用红色高亮
  - 播放控制：播放/暂停、进度条、逐帧控制
  - 双视频同步播放（左参考、右用户）

**验证方式**:
- [ ] 导入测试数据，骨架绘制正确
- [ ] 播放流畅（≥ 24 FPS）
- [ ] 问题点红色高亮显示

**依赖**:
- T2.3（获取骨架数据格式）

**风险点**:
- 🔴 Canvas 渲染性能可能不足（大量关键点）
- ⚠️ 移动端 Canvas 兼容性问题
- **应对**: 
  - 使用 requestAnimationFrame 优化
  - 降低移动端渲染精度

---

### T3.7 - 实现结果展示页面 [x]已完成

**优先级**: P0  
**估算工时**: 6 小时  
**风险等级**: 🟡 中风险

**任务描述**:  
整合骨架可视化和对比结果，完成结果页面。

**输入**:
- 任务 ID（从 URL 获取）
- Python 后端 `GET /api/results/{id}` 接口
- T3.6 骨架可视化组件

**输出**:
- `app/[locale]/analysis/results/[id]/page.tsx`
- 页面布局（架构文档 3.2.2 页面 D）：
  - 顶部：总体评分（可选）
  - 中部：左右对比骨架动画
  - 底部：4 个对比维度卡片
    - ✅/⚠️/❌ 状态图标
    - 问题说明 + 数据对比
    - 改进建议
  - 操作按钮：「删除此次分析」「再次分析」

**验证方式**:
- [ ] 完整流程测试：从上传 → 分析 → 结果展示
- [ ] UI 响应式测试（移动端/桌面端）
- [ ] 多语言测试（en/zh）

**依赖**:
- T3.6, T2.6

**风险点**:
- ⚠️ 大量数据渲染可能导致页面卡顿
- **应对**: 懒加载骨架数据，仅加载当前播放帧

---

## 阶段 4：部署与测试（共 5 个任务） [/]进行中

### T4.1 - Python 后端 Docker 化 [x]已完成

**优先级**: P0  
**估算工时**: 2 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
创建 Dockerfile，将 Python 后端容器化。

**输入**:
- T2.1-T2.8 完成的 Python 项目
- 依赖清单 `requirements.txt`

**输出**:
- `movechecker-ai-backend/Dockerfile`
- `docker-compose.yml`（可选，用于本地测试）

**验证方式**:
- [ ] `docker build -t movechecker-ai .` 构建成功
- [ ] `docker run` 启动成功，API 可访问

**依赖**:
- 阶段 2 所有任务

---

### T4.2 - 部署 Python 后端到 Render

**优先级**: P0  
**估算工时**: 3 小时  
**风险等级**: 🟡 中风险

**任务描述**:  
将 Python 后端部署到 Render 云平台。

**输入**:
- GitHub 仓库（包含 Dockerfile 和 render.yaml）
- Render 账户
- Supabase 连接凭证

**输出**:
- Render 应用 URL：`https://movechecker-ai-backend.onrender.com`
- 环境变量配置：
  ```
  SUPABASE_URL=...
  SUPABASE_SERVICE_ROLE_KEY=...
  ```

**验证方式**:
- [ ] `curl https://movechecker-ai-backend.onrender.com/api/tasks/test` 返回正常响应
- [ ] 查看 Render 日志无报错

**依赖**:
- T4.1

**风险点**:
- ⚠️ Render 免费版 Cold Start 问题 (约 50s 延迟)
- **应对**: 前端增加加载提示

---

### T4.3 - 配置前端环境变量 [/]进行中

**优先级**: P0  
**估算工时**: 0.5 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
在 Cloudflare Pages 中配置 Python 后端 URL。

**输入**:
- T4.2 部署的后端 URL

**输出**:
- Cloudflare Pages 环境变量：
  ```
  NEXT_PUBLIC_AI_BACKEND_URL=https://movechecker-ai-backend.onrender.com
  ```

**验证方式**:
- [ ] 前端代码能正确读取环境变量

**依赖**:
- T4.2

---

### T4.4 - 端到端测试（E2E）

**优先级**: P0  
**估算工时**: 4 小时  
**风险等级**: 🟡 中风险

**任务描述**:  
完整测试从用户注册到结果展示的全流程。

**输入**:
- 生产环境部署的前端和后端
- 测试账户
- 测试视频素材（标准深蹲 + 错误深蹲）

**输出**:
- 测试报告（checklist）：
  - [ ] 用户注册/登录（Supabase Auth）
  - [ ] 选择默认参考视频
  - [ ] 上传用户视频（≤ 15 秒）
  - [ ] 提交分析任务
  - [ ] 分析中页面轮询状态
  - [ ] 结果页面正确展示 4 个维度
  - [ ] 骨架可视化播放流畅
  - [ ] 删除分析记录

**验证方式**:
- [ ] 所有测试点通过
- [ ] 记录完整流程耗时（目标 ≤ 40 秒）

**依赖**:
- 所有前置任务

**风险点**:
- ⚠️ 跨域请求可能被 CORS 阻止
- **应对**: 配置 FastAPI CORS 中间件

---

### T4.5 - 性能压测与优化

**优先级**: P2  
**估算工时**: 4 小时  
**风险等级**: 🟡 中风险

**任务描述**:  
测试系统在并发请求下的性能表现。

**输入**:
- 压测工具（如 Locust / k6）
- 生产环境 API

**输出**:
- 压测报告：
  - 并发用户数：10 / 50 / 100
  - 分析任务成功率
  - P95 响应时间
- 性能优化措施（如需要）：
  - 增加 Fly.io 实例数量
  - 优化 MediaPipe 模型加载

**验证方式**:
- [ ] 10 并发用户下成功率 ≥ 95%
- [ ] 单次分析 P95 耗时 ≤ 40 秒

**依赖**:
- T4.4

**风险点**:
- ⚠️ MVP 阶段可能无法支持高并发
- **应对**: 文档明确说明并发限制，引导用户错峰使用

---

## 阶段 5：补充任务（共 3 个任务）

### T5.1 - 创建拍摄指南页面

**优先级**: P1  
**估算工时**: 3 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
开发使用指南页面，降低用户操作门槛。

**输入**:
- 架构文档 3.2.3 节内容定义

**输出**:
- `app/[locale]/guide/page.tsx`
- 内容：
  - 推荐拍摄角度图示
  - 正确/错误示例对比
  - 常见问题 FAQ

**验证方式**:
- [ ] 页面访问正常
- [ ] 图示清晰易懂

**依赖**:
- 无（独立任务）

---

### T5.2 - 创建隐私政策页面

**优先级**: P2  
**估算工时**: 1 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
撰写隐私政策，明确数据使用规则。

**输入**:
- 架构文档 3.2.5 节内容定义

**输出**:
- `app/[locale]/privacy/page.tsx`
- 内容：
  - 视频存储说明
  - 数据使用政策
  - 用户权利（删除数据）

**验证方式**:
- [ ] 页面访问正常
- [ ] 内容符合 GDPR 要求（如面向欧盟用户）

**依赖**:
- 无（独立任务）

---

### T5.3 - 更新首页 CTA

**优先级**: P1  
**估算工时**: 2 小时  
**风险等级**: 🟢 低风险

**任务描述**:  
修改首页，添加「开始分析我的深蹲」入口。

**输入**:
- 现有首页 `app/[locale]/page.tsx`

**输出**:
- 首页新增模块：
  - Hero 区域 CTA 按钮：「免费分析动作」
  - 链接到 `/analysis/upload`
  - 简短价值说明（3 个核心卖点）

**验证方式**:
- [ ] 点击按钮正确跳转到上传页面

**依赖**:
- T3.1

---

## 任务执行顺序建议

### 关键路径（Critical Path）

按依赖关系，推荐执行顺序如下：

#### 第 1 天：数据库基础设施
1. **T1.1** → **T1.2** → **T1.3**（串行执行）

#### 第 2-3 天：Python 后端核心功能
2. **T2.1** → **T2.2** → **T2.3**（串行）
3. **T2.4** 和 **T2.5**（高风险任务，需集中精力，可先做 T2.4 再做 T2.5）

#### 第 4 天：Python 后端 API 层
4. **T2.8**（可与 T2.6 并行）
5. **T2.6** → **T2.7**（串行）

#### 第 5 天：前端基础搭建
6. **T3.1** → **T3.2** → **T3.3** → **T3.4**（串行）

#### 第 6 天：前端核心页面
7. **T3.5**（简单任务）
8. **T3.6**（高风险任务，需集中精力）

#### 第 7 天：前端结果页面
9. **T3.7**（依赖 T3.6）

#### 第 8 天：部署
10. **T4.1** → **T4.2** → **T4.3**（串行）
11. **T4.4**（E2E 测试）

#### 第 9 天（可选）：优化与补充
12. **T4.5**（性能测试）
13. **T5.1**, **T5.2**, **T5.3**（可并行）

---

### 并行执行建议

以下任务组可在团队协作时并行开发：

- **数据库 + Python 环境**：T1.* 和 T2.1-T2.2 可并行
- **前端路由 + 后端 API**：T3.1 和 T2.6 可并行
- **补充页面**：T5.1, T5.2, T5.3 可并行

---

## 高风险任务标记

| 任务编号 | 任务名称 | 风险等级 | 风险原因 | 应对策略 |
|---------|---------|---------|---------|---------|
| **T2.4** | 深蹲动作阶段切分算法 | 🔴 高风险 | 算法准确性不可控，直接影响产品价值 | 1. 初期提供手动标注降级方案<br>2. 收集 Bad Case 迭代 |
| **T2.5** | 深蹲对比维度计算 | 🔴 高风险 | 阈值设置难度大，误判率高 | 1. 提供 3 档敏感度选项<br>2. 用户反馈机制 |
| **T3.6** | 骨架可视化组件 | 🔴 高风险 | Canvas 性能问题，移动端兼容性 | 1. requestAnimationFrame 优化<br>2. 降低移动端精度 |
| **T2.2** | 安装核心依赖 | 🟡 中风险 | MediaPipe 在某些系统编译失败 | 使用 Docker 统一环境 |
| **T3.2** | 视频上传组件 | 🟡 中风险 | 大文件上传可能超时 | Supabase 分片上传 + 重试 |
| **T4.2** | 部署到 Fly.io | 🟡 中风险 | 免费额度限制 | 监控资源，必要时升级 |

---

## 总结与建议

### 总工时估算
- **阶段 1**：3.5 小时
- **阶段 2**：30 小时
- **阶段 3**：31 小时
- **阶段 4**：13.5 小时
- **阶段 5**：6 小时
- **总计**：**84 小时** ≈ **11 个工作日**（单人全职）

### 团队协作建议
如配置 2 人团队（前端 + 后端）：
- **后端工程师**：负责阶段 1 + 阶段 2（5 天）
- **前端工程师**：负责阶段 3（4 天）
- **联合**：阶段 4 部署测试（2 天）
- **预计总周期**：**7 个工作日**

### 最小验证版本（MVV）
如需进一步缩短周期，可先完成以下核心任务，形成最小可验证版本：

**核心路径（3 天）**：
- T1.1, T1.2, T1.3（数据库）
- T2.1, T2.2, T2.3, T2.5（AI 后端，跳过 T2.4 动作切分）
- T3.1, T3.2, T3.4, T3.7（前端，手动选择单帧对比）
- T4.1, T4.2, T4.3, T4.4（部署）

**降级方案**：
- 不做动作视频分析，改为上传单张图片对比姿态
- 前端手动标记对比关键帧
- 跳过骨架动画，仅展示静态对比图

---

**文档状态**：✅ 完成  
**审核人**：Product Owner / Tech Lead  
**下一步**：确认任务优先级，分配开发资源,开始执行
